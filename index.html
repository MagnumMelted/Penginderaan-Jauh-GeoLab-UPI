<!DOCTYPE html>
<html>
<head>
    <title>Penginderaan Jauh - GeoLabUPI</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Styles -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="https://magnummelted.github.io/Penginderaan-Jauh-GeoLab-UPI/style.css" />
    <style>
        html, body, #map {
            height: 100%;
            margin: 0;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen" x-data="{ open: false }">
    <header class="bg-white shadow p-4 flex items-center justify-between">
        <h1 class="text-xl font-bold text-gray-800">Penginderaan Jauh</h1>
        <h1 class="text-xl font-bold text-gray-800">GeoLab UPI</h1>
    </header>
    
    <div class="flex flex-1 min-h-[calc(100vh-4rem)]" x-data="petaSekolah" x-init="initMap()">
        
        <!-- SIDEBAR KIRI -->
        <div class="bg-gray-800 text-white w-64 p-4 md:block" :class="{ 'hidden': !open }">
            <h2 class="text-lg font-semibold mb-4">Tipe Peta Dasar</h2>
            <template x-for="(layer, key) in { 'ESRI World Imagery': true, 'Google Satellite': true, 'OpenStreetMap': true}" :key="key">
                <label class="flex items-center mb-2 transition-colors hover:bg-gray-700 rounded cursor-pointer">
                    <input type="radio" name="basemap" :value="key" @change="
                        Object.keys(map._layers).forEach(lid => {
                            let lyr = map._layers[lid];
                            if (lyr.options && lyr.options.attribution) {
                                map.removeLayer(lyr);
                            }
                        });
                        if (key === 'ESRI World Imagery') {
                            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                                attribution: 'Tiles &copy; Esri'
                            }).addTo(map);
                        } else if (key === 'Google Satellite') {
                            L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
                                attribution: '&copy; Google'
                            }).addTo(map);
                        } else if (key === 'OpenStreetMap') {
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '&copy; OpenStreetMap'
                            }).addTo(map);
                        } 
                    " class="mr-2">
                    <span x-text="key"></span>
                </label>
            </template>
        </div>

        <!-- MAP -->
        <div id="map" class="flex-1"></div>

        <!-- SIDEBAR KANAN -->
        <div class="bg-gray-800 text-white w-64 p-4 shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold">Panel Analisis SIG</h2>
            </div>
            <hr class="border-gray-600 mb-4">

            <div>
                <h3 class="text-sm font-semibold mb-2">Zoom Muka Peta</h3>
                <input type="range" min="10" max="500" step="10"
                    x-model="mapZoomPercent" @input="applyMapZoom()"
                    class="w-full accent-green-500">
                <p class="text-xs text-gray-400 mt-1 text-center" x-text="mapZoomPercent + '%'"></p>
            </div>

            <hr class="border-gray-600 my-2">

            <!-- Analisis Buffer -->
            <div x-show="!isBuffering">
                <h3 class="text-sm font-semibold mb-2">Analisis Buffer</h3>
                <button @click="startBufferMode()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
                    Analisis Buffer
                </button>
            </div>

            <div x-show="isBuffering">
                <p class="text-sm text-yellow-400 mb-2">Klik titik di peta...</p>
                <button @click="cancelBufferMode()" class="w-full bg-gray-500 text-white p-2 text-xs rounded hover:bg-gray-600">Batalkan</button>
            </div>

            <div x-show="isBufferVisible">
                <button @click="clearBufferAnalysis()" class="w-full mt-2 bg-red-500 text-white p-2 rounded hover:bg-red-600">
                    Hapus Hasil Analisis
                </button>
            </div>

            <hr class="border-gray-600 my-2">

            <!-- Routing -->
            <div x-show="!isRouting">
                <h3 class="text-sm font-semibold mb-2">Analisis Rute</h3>
                <button @click="startRoutingMode()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
                    Analisis Rute
                </button>
            </div>

            <div x-show="isRouting">
                <p class="text-sm text-yellow-400 mb-2">Klik titik di peta...</p>
                <button @click="cancelRoutingMode()" class="w-full bg-gray-500 text-white p-2 text-xs rounded hover:bg-gray-600">Batalkan</button>
            </div>

            <div x-show="isRouteVisible">
                <button @click="clearRoutingAnalysis()" class="w-full mt-2 bg-red-500 text-white p-2 rounded hover:bg-red-600">
                    Hapus Hasil Rute
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="https://magnummelted.github.io/Penginderaan-Jauh-GeoLab-UPI/script.js"></script>
</body>
</html>
